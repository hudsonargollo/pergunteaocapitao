@import "tailwindcss";

/* Modo Caverna Glass Morphism Design System - Cave-themed with WCAG 2.1 AA compliance */

@layer base {
  :root {
    /* Modo Caverna color palette - optimized for high contrast and accessibility */
    --background: 240 8% 6%;
    --background-secondary: 240 9% 9%;
    --foreground: 0 0% 98%;

    /* Glass surfaces with enhanced contrast for readability */
    --glass: 240 7% 12%;
    --glass-light: 240 9% 18%;
    --glass-lighter: 240 11% 24%;
    --glass-border: 0 100% 65%;

    /* Chat specific colors with improved contrast ratios */
    --chat-user: 0 100% 65%;
    --chat-ai: 240 12% 28%;
    --chat-background: 240 7% 5%;

    /* UI components with WCAG AA compliance */
    --card: 240 8% 10%;
    --card-foreground: 0 0% 96%;

    --popover: 240 9% 10%;
    --popover-foreground: 0 0% 96%;

    --primary: 0 100% 65%;
    --primary-foreground: 0 0% 98%;

    --secondary: 240 9% 16%;
    --secondary-foreground: 0 0% 92%;

    --muted: 240 7% 13%;
    --muted-foreground: 240 6% 70%;

    --accent: 0 85% 60%;
    --accent-foreground: 0 0% 98%;

    --destructive: 0 100% 65%;
    --destructive-foreground: 0 0% 98%;

    --border: 240 12% 22%;
    --input: 240 8% 12%;
    --ring: 0 100% 65%;

    --radius: 1rem;

    /* Enhanced Modo Caverna gradients with better contrast */
    --gradient-glass: linear-gradient(135deg, 
      hsla(240, 9%, 16%, 0.6) 0%, 
      hsla(0, 100%, 65%, 0.08) 30%, 
      hsla(240, 11%, 20%, 0.4) 70%, 
      hsla(0, 85%, 60%, 0.12) 100%);
    
    --gradient-border: linear-gradient(135deg, 
      hsla(0, 100%, 65%, 0.9) 0%, 
      hsla(0, 85%, 60%, 0.7) 20%, 
      hsla(240, 9%, 18%, 0.5) 40%, 
      hsla(0, 90%, 62%, 0.6) 60%, 
      hsla(240, 11%, 22%, 0.4) 80%, 
      hsla(0, 100%, 65%, 0.8) 100%);

    --gradient-chat-user: linear-gradient(135deg, 
      hsl(0, 100%, 65%) 0%, 
      hsl(0, 85%, 70%) 100%);
    
    --gradient-chat-ai: linear-gradient(135deg, 
      hsl(240, 12%, 28%) 0%, 
      hsl(240, 14%, 32%) 100%);

    /* Enhanced cave-themed shadows with depth */
    --shadow-glass: 0 8px 32px 0 rgba(0, 0, 0, 0.6);
    --shadow-glass-medium: 0 12px 40px 0 rgba(0, 0, 0, 0.4);
    --shadow-glass-strong: 0 16px 48px 0 rgba(0, 0, 0, 0.5);
    --shadow-glass-inset: inset 0 1px 0 0 rgba(255, 255, 255, 0.12);
    --shadow-glow: 0 0 24px rgba(255, 51, 51, 0.4);
    --shadow-glow-strong: 0 0 32px rgba(255, 51, 51, 0.6);

    /* Cave atmosphere lighting effects */
    --cave-light-warm: 45 100% 70%;
    --cave-light-cool: 240 30% 80%;
    --cave-ember: 15 100% 60%;

    /* Enhanced Cavernous Tech color variables */
    --cave-dark: 240 8% 4%;
    --cave-charcoal: 240 9% 11%;
    --cave-stone: 240 10% 24%;
    --cave-red: 0 100% 60%;
    --cave-ember-orange: 30 100% 50%;
    --cave-torch-gold: 45 100% 50%;
    --cave-white: 0 0% 100%;
    --cave-off-white: 0 0% 88%;
    --cave-mist: 240 5% 69%;
  }

  /* Dark mode optimizations for better contrast */
  @media (prefers-color-scheme: dark) {
    :root {
      --foreground: 0 0% 99%;
      --muted-foreground: 240 7% 75%;
      --card-foreground: 0 0% 97%;
      --popover-foreground: 0 0% 97%;
      --secondary-foreground: 0 0% 94%;
    }
  }
}

@theme inline {
  --color-background: var(--background);
  --color-foreground: var(--foreground);
  --font-sans: var(--font-geist-sans);
  --font-mono: var(--font-geist-mono);
}

@layer base {
  * {
    border-color: hsl(var(--border));
  }

  body {
    background-color: hsl(var(--background));
    color: hsl(var(--foreground));
    font-family: var(--font-sans);
    background: 
      radial-gradient(ellipse at 15% 15%, rgba(255, 51, 51, 0.12) 0%, transparent 45%),
      radial-gradient(ellipse at 85% 85%, rgba(255, 51, 51, 0.08) 0%, transparent 45%),
      radial-gradient(ellipse at 50% 30%, rgba(45, 100, 70, 0.04) 0%, transparent 60%),
      radial-gradient(ellipse at 30% 70%, rgba(15, 100, 60, 0.06) 0%, transparent 50%),
      linear-gradient(135deg, hsl(var(--background)) 0%, hsl(var(--background-secondary)) 100%);
    background-attachment: fixed;
    min-height: 100vh;
    
    /* Enhanced responsive typography */
    font-size: 16px;
    line-height: 1.6;
    
    /* Improved text rendering */
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    text-rendering: optimizeLegibility;
    
    /* Enhanced scrolling behavior */
    scroll-behavior: smooth;
    
    /* Better touch handling on mobile */
    -webkit-tap-highlight-color: transparent;
    touch-action: manipulation;
  }
  
  /* Enhanced responsive typography scaling */
  @media (max-width: 640px) {
    body {
      font-size: 14px;
      line-height: 1.5;
    }
  }
  
  @media (min-width: 1024px) {
    body {
      font-size: 16px;
      line-height: 1.6;
    }
  }
  
  @media (min-width: 1280px) {
    body {
      font-size: 17px;
      line-height: 1.65;
    }
  }

  /* Enhanced glass morphism utilities with improved readability */
  .glass {
    background: var(--gradient-glass);
    backdrop-filter: blur(28px) saturate(125%);
    border: 1px solid hsla(var(--glass-border), 0.18);
    box-shadow: 
      var(--shadow-glass),
      var(--shadow-glass-inset);
  }

  .glass-medium {
    background: linear-gradient(135deg, 
      hsla(var(--glass-light), 0.25) 0%, 
      hsla(0, 100%, 65%, 0.06) 40%, 
      hsla(var(--glass-lighter), 0.20) 100%);
    backdrop-filter: blur(36px) saturate(135%);
    border: 1px solid hsla(var(--glass-border), 0.28);
    box-shadow: 
      var(--shadow-glass-medium),
      inset 0 1px 0 0 rgba(255, 255, 255, 0.15),
      inset 0 -1px 0 0 rgba(255, 51, 51, 0.08);
  }

  .glass-strong {
    background: linear-gradient(135deg, 
      hsla(var(--glass-lighter), 0.45) 0%, 
      hsla(0, 100%, 65%, 0.08) 30%, 
      hsla(var(--glass-light), 0.35) 70%, 
      hsla(0, 85%, 60%, 0.10) 100%);
    backdrop-filter: blur(44px) saturate(145%);
    border: 1px solid hsla(var(--glass-border), 0.45);
    box-shadow: 
      var(--shadow-glass-strong),
      inset 0 1px 0 0 rgba(255, 255, 255, 0.18),
      inset 0 -1px 0 0 rgba(255, 51, 51, 0.12);
  }

  /* Enhanced glass border with cave lighting effects */
  .glass-border {
    position: relative;
    overflow: hidden;
  }

  .glass-border::before {
    content: '';
    position: absolute;
    inset: 0;
    padding: 1px;
    background: var(--gradient-border);
    border-radius: inherit;
    mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
    mask-composite: xor;
    -webkit-mask-composite: xor;
    opacity: 0.75;
  }

  .glass-border::after {
    content: '';
    position: absolute;
    inset: 0;
    background: radial-gradient(circle at 50% 0%, rgba(255, 51, 51, 0.15) 0%, transparent 70%);
    border-radius: inherit;
    pointer-events: none;
    opacity: 0.6;
  }

  /* Enhanced card layouts with cave atmosphere and accessibility */
  .card-elevated {
    transform: translateY(0) scale(1);
    transition: all 0.35s cubic-bezier(0.4, 0, 0.2, 1);
    will-change: transform, box-shadow;
  }

  .card-elevated:hover {
    transform: translateY(-3px) scale(1.01);
    box-shadow: 
      0 24px 72px 0 rgba(0, 0, 0, 0.4),
      inset 0 1px 0 0 rgba(255, 255, 255, 0.25),
      var(--shadow-glow);
  }

  .card-elevated:focus-within {
    transform: translateY(-2px) scale(1.005);
    box-shadow: 
      0 20px 60px 0 rgba(0, 0, 0, 0.35),
      inset 0 1px 0 0 rgba(255, 255, 255, 0.2),
      var(--shadow-glow-strong);
  }

  /* Smooth transitions optimized for performance */
  * {
    transition: color 0.25s cubic-bezier(0.4, 0, 0.2, 1),
                background-color 0.25s cubic-bezier(0.4, 0, 0.2, 1),
                border-color 0.25s cubic-bezier(0.4, 0, 0.2, 1),
                opacity 0.25s cubic-bezier(0.4, 0, 0.2, 1);
  }

  /* WCAG 2.1 AA compliant text with enhanced contrast - use text-cave-* classes instead */

  /* Enhanced focus indicators for WCAG 2.1 AA compliance */
  .focus-cave {
    outline: 3px solid hsl(var(--primary));
    outline-offset: 3px;
    box-shadow: 
      0 0 0 6px hsla(var(--primary), 0.25),
      var(--shadow-glow);
    border-radius: calc(var(--radius) + 2px);
  }

  .focus-cave:focus-visible {
    outline: 3px solid hsl(var(--primary));
    outline-offset: 3px;
    box-shadow: 
      0 0 0 6px hsla(var(--primary), 0.3),
      var(--shadow-glow-strong);
  }

  /* Enhanced accessibility focus indicators with cave theme */
  .cave-focus {
    outline: 3px solid hsl(var(--cave-red));
    outline-offset: 3px;
    box-shadow: 
      0 0 0 6px hsla(var(--cave-red), 0.25),
      0 0 20px rgba(255, 51, 51, 0.4);
    border-radius: calc(var(--radius) + 2px);
  }

  .cave-focus:focus-visible {
    outline: 4px solid hsl(var(--cave-red));
    outline-offset: 4px;
    box-shadow: 
      0 0 0 8px hsla(var(--cave-red), 0.3),
      0 0 32px rgba(255, 51, 51, 0.6);
  }

  /* Screen reader only content */
  .sr-only {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border: 0;
  }

  /* Skip link for keyboard navigation */
  .skip-link {
    position: absolute;
    top: -40px;
    left: 6px;
    background: hsl(var(--cave-red));
    color: hsl(var(--cave-white));
    padding: 8px;
    text-decoration: none;
    border-radius: 4px;
    z-index: 1000;
    font-weight: 600;
  }

  .skip-link:focus {
    top: 6px;
    outline: 3px solid hsl(var(--cave-white));
    outline-offset: 2px;
  }

  /* Cave-themed interactive states */
  .interactive-cave {
    position: relative;
    overflow: hidden;
  }

  .interactive-cave::before {
    content: '';
    position: absolute;
    inset: 0;
    background: linear-gradient(135deg, 
      rgba(255, 51, 51, 0.1) 0%, 
      transparent 50%, 
      rgba(255, 51, 51, 0.05) 100%);
    opacity: 0;
    transition: opacity 0.3s ease;
    pointer-events: none;
  }

  .interactive-cave:hover::before {
    opacity: 1;
  }

  /* Enhanced accessibility improvements with responsive considerations */
  @media (prefers-reduced-motion: reduce) {
    * {
      animation-duration: 0.01ms !important;
      animation-iteration-count: 1 !important;
      transition-duration: 0.01ms !important;
    }
    
    .card-elevated {
      transform: none !important;
    }
    
    /* Disable cave atmosphere animations for reduced motion */
    .animate-torch-flicker,
    .animate-ember-flicker,
    .animate-cave-glow,
    .animate-ember-drift,
    .animate-typing-pulse,
    .animate-captain-entrance,
    .animate-ripple,
    .animate-cave-shimmer {
      animation: none !important;
    }

    /* Disable framer-motion animations */
    .motion-reduce {
      animation: none !important;
      transition: none !important;
    }

    /* Ensure focus indicators remain visible */
    .focus-cave, .cave-focus {
      transition: none !important;
    }
  }

  /* Enhanced motion preferences support */
  @media (prefers-reduced-motion: no-preference) {
    /* Enable smooth animations for users who prefer motion */
    .motion-safe {
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .motion-safe-transform {
      transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
  }

  @media (prefers-contrast: high) {
    :root {
      --foreground: 0 0% 100%;
      --background: 240 10% 3%;
      --glass-border: 0 100% 70%;
      --primary: 0 100% 70%;
      --cave-red: 0 100% 75%;
      --cave-ember: 30 100% 65%;
    }
    
    .glass, .glass-medium, .glass-strong {
      border-width: 2px;
      background: hsl(var(--background));
    }
    
    .cave-glass, .cave-glass-subtle, .cave-glass-intense {
      border-width: 2px;
      background: hsl(var(--background));
    }
  }
  
  /* Enhanced mobile-specific optimizations */
  @media (max-width: 640px) {
    /* Optimize glass effects for mobile performance */
    .glass, .glass-medium, .glass-strong,
    .cave-glass, .cave-glass-subtle, .cave-glass-intense {
      backdrop-filter: blur(16px) saturate(120%);
    }
    
    /* Reduce shadow complexity on mobile */
    .card-elevated:hover {
      transform: translateY(-1px) scale(1.005);
      box-shadow: 
        0 12px 36px 0 rgba(0, 0, 0, 0.3),
        inset 0 1px 0 0 rgba(255, 255, 255, 0.15);
    }
    
    /* Optimize cave atmosphere for mobile */
    .cave-lighting::before {
      top: -25%;
      left: -25%;
      right: -25%;
      bottom: -25%;
    }
  }
  
  /* Tablet-specific optimizations */
  @media (min-width: 641px) and (max-width: 1024px) {
    .glass, .glass-medium, .glass-strong {
      backdrop-filter: blur(24px) saturate(130%);
    }
    
    .cave-glass, .cave-glass-subtle, .cave-glass-intense {
      backdrop-filter: blur(24px) saturate(140%);
    }
  }
  
  /* Desktop enhancements */
  @media (min-width: 1025px) {
    .glass, .glass-medium, .glass-strong {
      backdrop-filter: blur(32px) saturate(140%);
    }
    
    .cave-glass, .cave-glass-subtle, .cave-glass-intense {
      backdrop-filter: blur(32px) saturate(150%);
    }
    
    /* Enhanced hover effects for desktop */
    .card-elevated:hover {
      transform: translateY(-4px) scale(1.02);
    }
  }
  
  /* Ultra-wide screen optimizations */
  @media (min-width: 1920px) {
    .glass, .glass-medium, .glass-strong {
      backdrop-filter: blur(40px) saturate(150%);
    }
  }

  /* Enhanced button styles with cave theme */
  .btn-cave-primary {
    background: linear-gradient(135deg, hsl(var(--primary)) 0%, hsl(var(--accent)) 100%);
    border: 1px solid hsla(var(--primary), 0.8);
    box-shadow: 
      0 4px 16px rgba(255, 51, 51, 0.3),
      inset 0 1px 0 rgba(255, 255, 255, 0.2);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .btn-cave-primary:hover {
    background: linear-gradient(135deg, hsl(var(--primary)) 0%, hsl(var(--accent)) 100%);
    box-shadow: 
      0 6px 24px rgba(255, 51, 51, 0.4),
      inset 0 1px 0 rgba(255, 255, 255, 0.3);
    transform: translateY(-1px);
  }

  .btn-cave-secondary {
    background: var(--gradient-glass);
    border: 1px solid hsla(var(--glass-border), 0.3);
    backdrop-filter: blur(20px);
    box-shadow: var(--shadow-glass);
  }

  .btn-cave-secondary:hover {
    background: linear-gradient(135deg, 
      hsla(var(--glass-light), 0.4) 0%, 
      hsla(0, 100%, 65%, 0.1) 50%, 
      hsla(var(--glass-lighter), 0.3) 100%);
    box-shadow: 
      var(--shadow-glass-medium),
      var(--shadow-glow);
  }
}

/* Additional Cave-themed Utility Classes */
@layer utilities {
  /* Glass morphism variants for different use cases */
  .glass-subtle {
    background: linear-gradient(135deg, 
      hsla(var(--glass), 0.08) 0%, 
      hsla(0, 100%, 65%, 0.02) 50%, 
      hsla(var(--glass), 0.06) 100%);
    backdrop-filter: blur(20px) saturate(110%);
    border: 1px solid hsla(var(--glass-border), 0.12);
    box-shadow: 
      0 4px 16px 0 rgba(0, 0, 0, 0.15),
      inset 0 1px 0 0 rgba(255, 255, 255, 0.06);
  }

  .glass-intense {
    background: linear-gradient(135deg, 
      hsla(var(--glass-lighter), 0.6) 0%, 
      hsla(0, 100%, 65%, 0.12) 25%, 
      hsla(var(--glass-light), 0.5) 75%, 
      hsla(0, 85%, 60%, 0.15) 100%);
    backdrop-filter: blur(52px) saturate(155%);
    border: 2px solid hsla(var(--glass-border), 0.6);
    box-shadow: 
      0 20px 64px 0 rgba(0, 0, 0, 0.6),
      inset 0 2px 0 0 rgba(255, 255, 255, 0.25),
      inset 0 -2px 0 0 rgba(255, 51, 51, 0.15),
      var(--shadow-glow);
  }

  /* Cave-themed text utilities with proper contrast */
  .text-cave-primary {
    color: hsl(var(--foreground));
    text-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
    font-weight: 600;
  }

  .text-cave-secondary {
    color: hsl(var(--muted-foreground));
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
    font-weight: 500;
  }

  .text-cave-accent {
    background: linear-gradient(135deg, hsl(var(--primary)) 0%, hsl(var(--accent)) 100%);
    background-clip: text;
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.4);
    font-weight: 700;
  }

  .text-cave-ember {
    color: hsl(var(--cave-ember));
    text-shadow: 0 0 8px hsla(var(--cave-ember), 0.5);
    font-weight: 600;
  }

  /* Interactive states with cave atmosphere */
  .hover-cave-glow:hover {
    box-shadow: var(--shadow-glow);
    transform: translateY(-1px);
  }

  .hover-cave-lift:hover {
    transform: translateY(-2px) scale(1.02);
    box-shadow: var(--shadow-glass-medium);
  }

  .hover-cave-intense:hover {
    box-shadow: var(--shadow-glow-strong);
    border-color: hsla(var(--primary), 0.8);
  }

  /* Cave-themed borders and dividers */
  .border-cave {
    border-color: hsla(var(--glass-border), 0.3);
  }

  .border-cave-glow {
    border: 1px solid hsla(var(--primary), 0.4);
    box-shadow: inset 0 0 0 1px hsla(var(--primary), 0.2);
  }

  .divider-cave {
    height: 1px;
    background: linear-gradient(90deg, 
      transparent 0%, 
      hsla(var(--glass-border), 0.6) 20%, 
      hsla(var(--primary), 0.4) 50%, 
      hsla(var(--glass-border), 0.6) 80%, 
      transparent 100%);
  }

  /* Cave-themed backdrop blur utilities */
  .backdrop-blur-cave {
    backdrop-filter: blur(20px) saturate(120%);
  }

  .backdrop-blur-cave-medium {
    backdrop-filter: blur(28px) saturate(130%);
  }

  .backdrop-blur-cave-strong {
    backdrop-filter: blur(36px) saturate(140%);
  }

  /* Cave lighting effects */
  .cave-lighting {
    position: relative;
  }

  .cave-lighting::before {
    content: '';
    position: absolute;
    top: -50%;
    left: -50%;
    right: -50%;
    bottom: -50%;
    background: radial-gradient(circle, 
      rgba(255, 51, 51, 0.1) 0%, 
      rgba(255, 51, 51, 0.05) 30%, 
      transparent 70%);
    pointer-events: none;
    z-index: -1;
  }

  /* Accessibility enhancements */
  .focus-cave-strong:focus-visible {
    outline: 4px solid hsl(var(--primary));
    outline-offset: 4px;
    box-shadow: 
      0 0 0 8px hsla(var(--primary), 0.3),
      var(--shadow-glow-strong);
  }

  /* High contrast mode support */
  @media (prefers-contrast: high) {
    .glass, .glass-medium, .glass-strong {
      background: hsl(var(--background));
      border: 3px solid hsl(var(--primary));
    }
    
    .text-cave-primary, .text-cave-secondary {
      text-shadow: none;
      color: hsl(var(--foreground));
    }
    
    .btn-cave-primary, .btn-cave-secondary {
      background: hsl(var(--primary));
      border: 2px solid hsl(var(--foreground));
    }
  }

  /* Reduced motion support */
  @media (prefers-reduced-motion: reduce) {
    .card-elevated, .hover-cave-lift, .hover-cave-glow {
      transform: none !important;
      transition: none !important;
    }
    
    .animate-cave-glow, .animate-ember-flicker {
      animation: none !important;
    }
  }

  /* Enhanced viewport and orientation handling */
  @media (orientation: landscape) and (max-height: 640px) {
    /* Landscape mobile optimizations */
    .captain-image-responsive {
      width: 80px;
      height: 80px;
    }
    
    .chat-message-responsive {
      padding: 0.75rem 1rem;
      font-size: 0.875rem;
    }
    
    .chat-input-responsive {
      padding: 0.75rem 1rem;
      font-size: 0.9rem;
    }
  }
  
  @media (orientation: portrait) and (max-width: 640px) {
    /* Portrait mobile optimizations */
    .chat-container {
      /* Optimize for portrait mobile with keyboard */
      height: calc(100vh - 60px);
      height: calc(100dvh - 60px);
    }
  }
  
  /* Enhanced dark mode support */
  @media (prefers-color-scheme: dark) {
    :root {
      /* Ensure cave theme works well in dark mode */
      --cave-dark: 240 8% 3%;
      --cave-charcoal: 240 9% 8%;
      --cave-stone: 240 10% 20%;
    }
  }
  
  /* Enhanced light mode fallback (though cave theme is primarily dark) */
  @media (prefers-color-scheme: light) {
    :root {
      /* Maintain cave aesthetic even in light mode preference */
      --cave-dark: 240 8% 4%;
      --cave-charcoal: 240 9% 11%;
      --cave-stone: 240 10% 24%;
    }
  }
  
  /* Print styles */
  @media print {
    .glass, .glass-medium, .glass-strong {
      background: white !important;
      border: 1px solid black !important;
      box-shadow: none !important;
      backdrop-filter: none !important;
    }
    
    .cave-glass, .cave-glass-subtle, .cave-glass-intense {
      background: white !important;
      border: 1px solid black !important;
      box-shadow: none !important;
      backdrop-filter: none !important;
    }
    
    .text-cave-primary, .text-cave-secondary, .text-cave-accent {
      color: black !important;
      text-shadow: none !important;
      background: none !important;
      -webkit-text-fill-color: black !important;
    }
    
    /* Hide cave atmosphere effects in print */
    .animate-torch-flicker,
    .animate-ember-flicker,
    .animate-cave-glow,
    .animate-ember-drift {
      display: none !important;
    }
  }
  
  /* Enhanced focus management for keyboard navigation */
  @media (prefers-reduced-motion: no-preference) {
    .focus-cave {
      transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
    }
  }
  
  /* High refresh rate display optimizations */
  @media (min-resolution: 120dpi) {
    .animate-torch-flicker,
    .animate-ember-flicker,
    .animate-cave-glow {
      animation-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
    }
  }
}

/* Component-specific enhancements */
@layer components {
  /* Enhanced chat message styling */
  .chat-message-user {
    background: linear-gradient(135deg, 
      hsla(var(--glass-lighter), 0.45) 0%, 
      hsla(0, 100%, 65%, 0.08) 30%, 
      hsla(var(--glass-light), 0.35) 70%, 
      hsla(0, 85%, 60%, 0.10) 100%);
    backdrop-filter: blur(44px) saturate(145%);
    border: 1px solid hsla(var(--glass-border), 0.45);
    box-shadow: 
      var(--shadow-glass-strong),
      inset 0 1px 0 0 rgba(255, 255, 255, 0.18),
      inset 0 -1px 0 0 rgba(255, 51, 51, 0.12);
    /* Override with user-specific styling */
    background: var(--gradient-chat-user);
    border: 1px solid hsla(var(--chat-user), 0.4);
    box-shadow: 
      var(--shadow-glass-medium),
      inset 0 1px 0 rgba(255, 255, 255, 0.2);
  }

  .chat-message-ai {
    background: linear-gradient(135deg, 
      hsla(var(--glass-light), 0.25) 0%, 
      hsla(0, 100%, 65%, 0.06) 40%, 
      hsla(var(--glass-lighter), 0.20) 100%);
    backdrop-filter: blur(36px) saturate(135%);
    border: 1px solid hsla(var(--glass-border), 0.28);
    box-shadow: 
      var(--shadow-glass-medium),
      inset 0 1px 0 0 rgba(255, 255, 255, 0.15),
      inset 0 -1px 0 0 rgba(255, 51, 51, 0.08);
    /* Override with AI-specific styling */
    background: var(--gradient-chat-ai);
    border: 1px solid hsla(var(--chat-ai), 0.6);
    box-shadow: 
      var(--shadow-glass),
      inset 0 1px 0 rgba(255, 255, 255, 0.1);
  }

  /* Captain image container with enhanced glass frame */
  .captain-frame {
    position: relative;
    overflow: hidden;
    background: linear-gradient(135deg, 
      hsla(var(--glass-light), 0.25) 0%, 
      hsla(0, 100%, 65%, 0.06) 40%, 
      hsla(var(--glass-lighter), 0.20) 100%);
    backdrop-filter: blur(36px) saturate(135%);
    border: 1px solid hsla(var(--glass-border), 0.28);
    box-shadow: 
      var(--shadow-glass-medium),
      inset 0 1px 0 0 rgba(255, 255, 255, 0.15),
      inset 0 -1px 0 0 rgba(255, 51, 51, 0.08);
  }
  
  .captain-frame::before {
    content: '';
    position: absolute;
    inset: 0;
    padding: 1px;
    background: var(--gradient-border);
    border-radius: inherit;
    mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
    mask-composite: xor;
    -webkit-mask-composite: xor;
    opacity: 0.75;
  }

  .captain-frame::after {
    content: '';
    position: absolute;
    inset: 0;
    background: radial-gradient(circle at 30% 30%, 
      rgba(255, 51, 51, 0.15) 0%, 
      transparent 60%);
    pointer-events: none;
    mix-blend-mode: overlay;
  }

  /* Enhanced input field with cave styling */
  .input-cave {
    background: linear-gradient(135deg, 
      hsla(var(--glass-light), 0.25) 0%, 
      hsla(0, 100%, 65%, 0.06) 40%, 
      hsla(var(--glass-lighter), 0.20) 100%);
    backdrop-filter: blur(36px) saturate(135%);
    border: 1px solid hsla(var(--glass-border), 0.28);
    box-shadow: 
      var(--shadow-glass-medium),
      inset 0 1px 0 0 rgba(255, 255, 255, 0.15),
      inset 0 -1px 0 0 rgba(255, 51, 51, 0.08);
    /* Override with input-specific styling */
    background: linear-gradient(135deg, 
      hsla(var(--input), 0.8) 0%, 
      hsla(var(--glass), 0.6) 100%);
    border: 2px solid hsla(var(--glass-border), 0.3);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .input-cave:focus {
    border-color: hsla(var(--primary), 0.6);
    box-shadow: 
      var(--shadow-glow),
      inset 0 0 0 1px hsla(var(--primary), 0.2);
    background: linear-gradient(135deg, 
      hsla(var(--input), 0.9) 0%, 
      hsla(var(--glass-light), 0.7) 100%);
  }

  /* Loading states with cave theme */
  .loading-cave {
    position: relative;
    overflow: hidden;
  }

  .loading-cave::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, 
      transparent 0%, 
      rgba(255, 51, 51, 0.2) 50%, 
      transparent 100%);
    animation: shimmer 2s infinite;
  }

  @keyframes shimmer {
    0% { left: -100%; }
    100% { left: 100%; }
  }

  @keyframes ember-flicker {
    0%, 100% { opacity: 1; text-shadow: 0 0 8px hsla(var(--cave-ember), 0.5); }
    50% { opacity: 0.8; text-shadow: 0 0 12px hsla(var(--cave-ember), 0.7); }
  }

  @keyframes cave-glow {
    0%, 100% { box-shadow: var(--shadow-glow); }
    50% { box-shadow: var(--shadow-glow-strong); }
  }

  @keyframes cave-pulse {
    0%, 100% { 
      transform: scale(1);
      opacity: 1;
    }
    50% { 
      transform: scale(1.05);
      opacity: 0.8;
    }
  }

  @keyframes torch-flicker {
    0%, 100% { 
      opacity: 1;
      filter: brightness(1) hue-rotate(0deg);
    }
    25% { 
      opacity: 0.9;
      filter: brightness(1.1) hue-rotate(5deg);
    }
    50% { 
      opacity: 0.95;
      filter: brightness(0.9) hue-rotate(-3deg);
    }
    75% { 
      opacity: 0.85;
      filter: brightness(1.05) hue-rotate(2deg);
    }
  }

  @keyframes ember-drift {
    0% {
      transform: translateY(0) scale(1);
      opacity: 0.8;
    }
    50% {
      transform: translateY(-10px) scale(1.2);
      opacity: 1;
    }
    100% {
      transform: translateY(-20px) scale(0.8);
      opacity: 0;
    }
  }

  @keyframes cave-shimmer {
    0% {
      background-position: -200% 0;
    }
    100% {
      background-position: 200% 0;
    }
  }

  .animate-ember-flicker {
    animation: ember-flicker 3s ease-in-out infinite;
  }

  .animate-cave-glow {
    animation: cave-glow 4s ease-in-out infinite;
  }

  .animate-cave-pulse {
    animation: cave-pulse 2s ease-in-out infinite;
  }

  .animate-torch-flicker {
    animation: torch-flicker 2.5s ease-in-out infinite;
  }

  .animate-ember-drift {
    animation: ember-drift 3s ease-out infinite;
  }

  .animate-cave-shimmer {
    background: linear-gradient(
      90deg,
      transparent 0%,
      rgba(255, 51, 51, 0.2) 50%,
      transparent 100%
    );
    background-size: 200% 100%;
    animation: cave-shimmer 2s infinite;
  }

  /* Custom scrollbar styling */
  .scrollbar-thin {
    scrollbar-width: thin;
  }

  .scrollbar-track-glass {
    scrollbar-color: hsla(var(--glass-border), 0.3) transparent;
  }

  .scrollbar-thumb-glass-border {
    scrollbar-color: hsla(var(--glass-border), 0.6) transparent;
  }

  /* Webkit scrollbar styling */
  .scrollbar-thin::-webkit-scrollbar {
    width: 6px;
  }

  .scrollbar-thin::-webkit-scrollbar-track {
    background: transparent;
  }

  .scrollbar-thin::-webkit-scrollbar-thumb {
    background: hsla(var(--glass-border), 0.4);
    border-radius: 3px;
  }

  .scrollbar-thin::-webkit-scrollbar-thumb:hover {
    background: hsla(var(--glass-border), 0.6);
  }

  /* Enhanced utilities for animated chat component with responsive design */
  .cavernous-bg {
    background: linear-gradient(135deg, 
      hsl(var(--cave-dark)) 0%, 
      hsl(var(--cave-charcoal)) 50%, 
      hsl(var(--cave-stone)) 100%);
  }
  
  /* Responsive chat container utilities */
  .chat-container {
    height: 100vh;
    height: 100dvh; /* Dynamic viewport height for mobile */
    max-height: 100vh;
    max-height: 100dvh;
    overflow: hidden;
  }
  
  @media (max-width: 640px) {
    .chat-container {
      /* Account for mobile browser UI */
      height: calc(100vh - env(safe-area-inset-top) - env(safe-area-inset-bottom));
      height: calc(100dvh - env(safe-area-inset-top) - env(safe-area-inset-bottom));
    }
  }
  
  /* Enhanced responsive message styling */
  .chat-message-responsive {
    max-width: 85%;
    padding: 1rem 1.25rem;
    border-radius: 1.5rem;
  }
  
  @media (max-width: 640px) {
    .chat-message-responsive {
      max-width: 90%;
      padding: 0.875rem 1rem;
      border-radius: 1.25rem;
      font-size: 0.9rem;
    }
  }
  
  @media (min-width: 1024px) {
    .chat-message-responsive {
      max-width: 75%;
      padding: 1.25rem 1.5rem;
      border-radius: 1.75rem;
    }
  }
  
  /* Responsive Captain image sizing */
  .captain-image-responsive {
    width: 120px;
    height: 120px;
  }
  
  @media (max-width: 640px) {
    .captain-image-responsive {
      width: 100px;
      height: 100px;
    }
  }
  
  @media (min-width: 1024px) {
    .captain-image-responsive {
      width: 140px;
      height: 140px;
    }
  }
  
  @media (min-width: 1280px) {
    .captain-image-responsive {
      width: 160px;
      height: 160px;
    }
  }
  
  /* Responsive input area styling */
  .chat-input-responsive {
    padding: 1rem 1.5rem;
    border-radius: 1rem;
    font-size: 1rem;
  }
  
  @media (max-width: 640px) {
    .chat-input-responsive {
      padding: 0.875rem 1rem;
      border-radius: 0.875rem;
      font-size: 0.9rem;
    }
  }
  
  @media (min-width: 1024px) {
    .chat-input-responsive {
      padding: 1.125rem 1.75rem;
      border-radius: 1.125rem;
      font-size: 1.05rem;
    }
  }
  
  /* Enhanced mobile touch targets */
  .touch-target {
    min-height: 44px;
    min-width: 44px;
  }
  
  @media (max-width: 640px) {
    .touch-target {
      min-height: 48px;
      min-width: 48px;
    }
  }
  
  /* Responsive spacing utilities */
  .space-responsive {
    gap: 1rem;
  }
  
  @media (max-width: 640px) {
    .space-responsive {
      gap: 0.75rem;
    }
  }
  
  @media (min-width: 1024px) {
    .space-responsive {
      gap: 1.25rem;
    }
  }
  
  /* Enhanced safe area handling for mobile devices */
  .safe-area-padding {
    padding-top: env(safe-area-inset-top);
    padding-bottom: env(safe-area-inset-bottom);
    padding-left: env(safe-area-inset-left);
    padding-right: env(safe-area-inset-right);
  }
  
  .safe-area-margin {
    margin-top: env(safe-area-inset-top);
    margin-bottom: env(safe-area-inset-bottom);
    margin-left: env(safe-area-inset-left);
    margin-right: env(safe-area-inset-right);
  }

  /* Cave-themed glass morphism utility classes */
  .cave-glass {
    background: rgba(28, 28, 28, 0.8);
    backdrop-filter: blur(20px) saturate(180%);
    border: 1px solid rgba(255, 51, 51, 0.2);
    border-radius: 16px;
    box-shadow: 
      0 8px 32px rgba(0, 0, 0, 0.4),
      inset 0 1px 0 rgba(255, 255, 255, 0.1),
      0 0 20px rgba(255, 51, 51, 0.1);
  }

  .cave-glass-subtle {
    background: rgba(28, 28, 28, 0.6);
    backdrop-filter: blur(16px) saturate(160%);
    border: 1px solid rgba(255, 51, 51, 0.15);
    border-radius: 12px;
    box-shadow: 
      0 4px 24px rgba(0, 0, 0, 0.3),
      inset 0 1px 0 rgba(255, 255, 255, 0.08),
      0 0 16px rgba(255, 51, 51, 0.08);
  }

  .cave-glass-intense {
    background: rgba(28, 28, 28, 0.9);
    backdrop-filter: blur(28px) saturate(200%);
    border: 2px solid rgba(255, 51, 51, 0.3);
    border-radius: 20px;
    box-shadow: 
      0 12px 48px rgba(0, 0, 0, 0.5),
      inset 0 2px 0 rgba(255, 255, 255, 0.15),
      0 0 32px rgba(255, 51, 51, 0.15);
  }

  /* Cave-themed button styling with gradient backgrounds and hover effects */
  .cave-button {
    background: linear-gradient(135deg, #FF3333 0%, #CC2929 100%);
    border: 1px solid rgba(255, 255, 255, 0.2);
    color: #FFFFFF;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
  }

  .cave-button::before {
    content: '';
    position: absolute;
    inset: 0;
    background: linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, transparent 50%);
    opacity: 0;
    transition: opacity 0.3s ease;
  }

  .cave-button:hover {
    background: linear-gradient(135deg, #FF4444 0%, #DD3333 100%);
    box-shadow: 0 0 20px rgba(255, 51, 51, 0.4);
    transform: translateY(-2px);
  }

  .cave-button:hover::before {
    opacity: 1;
  }

  .cave-button:focus {
    outline: none;
    box-shadow: 
      0 0 0 2px rgba(255, 51, 51, 0.6),
      0 0 0 4px rgba(255, 51, 51, 0.2),
      0 0 20px rgba(255, 51, 51, 0.4);
  }

  .cave-button:active {
    transform: translateY(0);
    box-shadow: 0 0 12px rgba(255, 51, 51, 0.3);
  }

  /* Semi-transparent overlays with cave-appropriate opacity */
  .cave-overlay {
    background: rgba(10, 10, 11, 0.8);
    backdrop-filter: blur(12px);
  }

  .cave-overlay-light {
    background: rgba(28, 28, 28, 0.6);
    backdrop-filter: blur(8px);
  }

  .cave-overlay-dark {
    background: rgba(10, 10, 11, 0.9);
    backdrop-filter: blur(16px);
  }

  /* Subtle glow effects using cave-red for focus states */
  .cave-glow {
    box-shadow: 0 0 16px rgba(255, 51, 51, 0.3);
  }

  .cave-glow-subtle {
    box-shadow: 0 0 8px rgba(255, 51, 51, 0.2);
  }

  .cave-glow-intense {
    box-shadow: 0 0 24px rgba(255, 51, 51, 0.4);
  }

  .cave-glow-ember {
    box-shadow: 0 0 16px rgba(255, 165, 0, 0.3);
  }

  /* Focus states with cave-red glow */
  .cave-focus {
    outline: none;
    box-shadow: 
      0 0 0 2px rgba(255, 51, 51, 0.6),
      0 0 0 4px rgba(255, 51, 51, 0.2),
      0 0 16px rgba(255, 51, 51, 0.3);
  }

  .cave-focus-ring {
    outline: none;
    box-shadow: 
      0 0 0 3px rgba(255, 51, 51, 0.5),
      0 0 0 6px rgba(255, 51, 51, 0.15);
  }

  .cavernous-glass {
    background: linear-gradient(135deg, 
      hsla(var(--cave-charcoal), 0.8) 0%, 
      hsla(var(--cave-red), 0.06) 40%, 
      hsla(var(--cave-stone), 0.7) 100%);
    backdrop-filter: blur(20px) saturate(180%);
    border: 1px solid hsla(var(--cave-red), 0.2);
    box-shadow: 
      0 8px 32px rgba(0, 0, 0, 0.4),
      inset 0 1px 0 rgba(255, 255, 255, 0.1),
      0 0 20px hsla(var(--cave-red), 0.1);
  }

  .cavernous-button {
    background: linear-gradient(135deg, 
      hsl(var(--cave-red)) 0%, 
      hsl(var(--cave-ember-orange)) 100%);
    border: 1px solid rgba(255, 255, 255, 0.2);
    color: hsl(var(--cave-white));
    transition: all 0.3s ease;
  }

  .cavernous-button:hover {
    background: linear-gradient(135deg, 
      hsl(var(--cave-red)) 0%, 
      hsl(var(--cave-ember-orange)) 100%);
    box-shadow: 0 0 20px hsla(var(--cave-red), 0.4);
    transform: translateY(-2px);
  }

  .cavernous-text-primary {
    color: hsl(var(--cave-white));
    text-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
  }

  .cavernous-text-secondary {
    color: hsl(var(--cave-off-white));
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
  }

  .cavernous-text-accent {
    background: linear-gradient(135deg, 
      hsl(var(--cave-red)) 0%, 
      hsl(var(--cave-ember-orange)) 100%);
    background-clip: text;
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.4);
  }

  .cavernous-border {
    border-color: hsla(var(--cave-red), 0.2);
  }

  .cavernous-focus {
    outline: 3px solid hsl(var(--cave-red));
    outline-offset: 3px;
    box-shadow: 
      0 0 0 6px hsla(var(--cave-red), 0.25),
      0 0 24px hsla(var(--cave-red), 0.4);
  }
}